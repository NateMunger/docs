---
pagination_label: "Courier Automations: Introduction"
sidebar_position: 1
slug: ./
toc_max_heading_level: 2
---

import TOCInline from "@theme/TOCInline";
import Image from "@theme/IdealImage";

# Introduction

Automations is a fully managed orchestration service that makes it easy to design complex notification workflows with one API.
Most notification workflows are highly nuanced and require specific delivery logic to delight the end user. Some simple examples include
delaying the delivery of a notification, fetching the latest data to include with a notification, canceling the delivery of a notification, or scheduling a reoccurring notification.
These types of delivery strategies can easily be implemented using Courier Automations.

## The Courier Automation Toolset

There are two ways to utilize the power of Courier Automations, simply using the `/automation/invoke` API or by using the visual template designer.

## The Invoke API

It is possible to quickly create and invoke an Automation Run using only the `/automation/invoke` API. With this approach the Automation definition
is defined in the request body and is immediately executed at request time.

For example, lets say we want to send a "Tips and Tricks" message to a new user who signs up to our application. We don't want to overwhelm the
new user with notifications right after they sign up, so we will delay the message delivery by 1 day. In this case we can simply define the Automation Run
as JSON:

```json
{
  "automation": {
    "steps": [
      {
        "action": "delay",
        "duration": "1 day"
      },
      {
        "action": "send",
        "recipient": "user_id",
        "template": "TIPS_AND_TRICKS"
      }
    ]
  }
}
```

and we could use an http client to make the following API call:

```javascript
const axios = require("axios");

const data = JSON.stringify({
  automation: {
    steps: [
      {
        action: "delay",
        duration: "1 day",
      },
      {
        action: "send",
        recipient: "user_id",
        template: "TIPS_AND_TRICKS",
      },
    ],
  },
});

axios({
  method: "post",
  url: "https://api.courier.com/automations/invoke",
  headers: {
    Authorization: "Bearer token",
    "Content-Type": "application/json",
  },
  data,
})
  .then(function (response) {
    console.log(JSON.stringify(response.data));
  })
  .catch(function (error) {
    console.log(error);
  });
```

For such simple use cases it is often convenient to define the Automation workflow directly in the API request body. However if your use case requires more
logical steps, scheduling functionality or if you would just like Courier to save the Automation definition for future use, then
consider using the [The Template Designer](#the-template-designer).

For more information on additional properties see the [Passing Dynamic Data](#passing-dynamic-data) section below or visit the [Automation Steps](steps) documentation section.

## The Template Designer

The Automation Template Designer is an ideal tool to define a series of [Automation Steps](steps) once and invoke them
with either an [Automation Trigger](triggers) or an API call.

Using the above example, imagine we no longer want to manage the Automation code, but instead we want Courier to store that logic. This allows us
to easily edit the Automation Run in the future while reducing our Courier code footprint.

We can turn the above call into a Automation Template, using the following procedure:

1. Navigate to `https://app.courier.com/designer/automations` and click `Create Template`.

<Image img={require("../assets/automations/create-template.png")} alt="" />

2. Name the template and alias `DELAYED_DELIVERY` and toggle the editor to "Code Mode"

<Image img={require("../assets/automations/code-mode.png")} alt="" />

3. Copy and paste the request body from the original request into the Automation editor and click Publish:

```json
{
  "steps": [
    {
      "action": "delay",
      "duration": "1 day"
    },
    {
      "action": "send",
      "recipient": "user_id",
      "template": "TIPS_AND_TRICKS"
    }
  ]
}
```

<Image img={require("../assets/automations/code-mode-editor-example.png")} alt="" />

4. Now we can invoke the Automation Template using the alias we provided in step 2.

```javascript
const axios = require("axios");

axios({
  method: "post",
  url: "https://api.courier.com/automations/DELAYED_DELIVERY/invoke",
  headers: {
    Authorization: "Bearer token",
    "Content-Type": "application/json",
  },
})
  .then(function (response) {
    console.log(JSON.stringify(response.data));
  })
  .catch(function (error) {
    console.log(error);
  });
```

As you can see this application code is now a lot less to read and maintain. We also get the added benefit to update the
Automation Template, without updating our application code. Lets extend this example to wait an additional day and then
send our new user our latest blog post. This quickly implemented leveraging the Automation Template designer.

1. Toggle the editor back to "Visual Mode".

<Image img={require("../assets/automations/visual-mode.png")} alt="" />

2. Select "New Step", and then select "Delay"

<Image img={require("../assets/automations/visual-mode-new-step.png")} alt="" />
<Image img={require("../assets/automations/visual-mode-delay-step.png")} alt="" />

3. Edit the Delay form to wait for 1 Day.

<Image img={require("../assets/automations/visual-mode-delay-form.png")} alt="" />

4. Select "New Step" again, and then select "Send", and update the Send form.

<Image img={require("../assets/automations/visual-mode-send-form.png")} alt="" />

5. Publish the template.

For more information on how to schedule or invoke an Automation Template from an Event see the [Triggers](triggers) section.

## Passing Dynamic Data

In addition to providing your automation a `step` array of Automation Steps, you can include the following properties to your Automation Run by making a call to
`/automations/invoke` or by invoking an Automation Template by making a call to `/automations/:templateId/invoke`

- `brand`
  - type: string
  - description: A unique identifier that represents the brand that should be used for rendering the notification.
- `data`
  - type: object
  - description: An object that includes any data you want to pass to a message template or accessor type. The data will populate the corresponding template variables.
- `profile`
  - type: object
  - description: an object that includes any key-value pairs required by your chosen Integrations (see our Provider Documentation for the requirements for each Integration.) If profile information is included in the request and that information already exists in the profile for the recipientId, that information will be merged.
- `template`
  - type: string
  - description: A unique identifier that can be mapped to an individual Notification. This could be the "Notification ID‚Äù on Notification detail pages (see the Notifications page in the Courier app) or a custom string mapped to the event in settings.
- `recipient`
  - type: string
  - description: A unique identifier associated with the recipient of the delivered message, which can optionally map to a Courier managed profile.

## Accessing Dynamic Data

It is a common use case to [send dynamic data](#passing-dynamic-data) to your Automation Run.
There are two ways to access the dynamic data that is made available to the Automation Run at request time.

### Using Accessor Types in Code Mode

If you are defining your Automation Run directly in the Request body, then you can use "accessor types" to reference
the data from the API call.

For example if we wanted to pass the `userId` as the recipient of the Send step from our earlier use case, then we can reference this dynamic data
using an "accessor type".

1. Navigate back to the Automation Template designer and select the `DELAYED_DELIVERY` template.

<Image img={require("../assets/automations/code-mode-hard-coded-recipient.png")} alt="" />

2. Replace the Send step to the following

```json
{
  "action": "send",
  "recipient": {
    "$ref": "data.user_id"
  },
  "template": "TIPS_AND_TRICKS"
}
```

<Image img={require("../assets/automations/code-mode-accessor-type.png")} alt="" />

3. Finally we can update the API call and pass the data.

```javascript
const axios = require("axios");

// get the userId
const userId = db.getUserId();

// pass the data with the http call
const data = JSON.stringify({
  data: {
    userId,
  },
});

axios({
  method: "post",
  url: "https://api.courier.com/automations/DELAYED_DELIVERY/invoke",
  headers: {
    Authorization: "Bearer token",
    "Content-Type": "application/json",
  },
  data,
})
  .then(function (response) {
    console.log(JSON.stringify(response.data));
  })
  .catch(function (error) {
    console.log(error);
  });
```
